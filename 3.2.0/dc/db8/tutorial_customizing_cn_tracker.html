<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>OpenCV: Customizing the CN Tracker</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
//<![CDATA[
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
//]]>
</script><script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">3.2.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<script type="text/javascript">
//<![CDATA[
function getLabelName(innerHTML) {
    var str = innerHTML.toLowerCase();
    // Replace all '+' with 'p'
    str = str.split('+').join('p');
    // Replace all ' ' with '_'
    str = str.split(' ').join('_');
    // Replace all '#' with 'sharp'
    str = str.split('#').join('sharp');
    // Replace other special characters with 'ascii' + code
    for (var i = 0; i < str.length; i++) {
        var charCode = str.charCodeAt(i);
        if (!(charCode == 95 || (charCode > 96 && charCode < 123) || (charCode > 47 && charCode < 58)))
            str = str.substr(0, i) + 'ascii' + charCode + str.substr(i + 1);
    }
    return str;
}
function addToggle() {
    var $getDiv = $('div.newInnerHTML').last();
    var buttonName = $getDiv.html();
    var label = getLabelName(buttonName.trim());
    $getDiv.attr("title", label);
    $getDiv.hide();
    $getDiv = $getDiv.next();
    $getDiv.attr("class", "toggleable_div label_" + label);
    $getDiv.hide();
}
//]]>
</script>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d3/d81/tutorial_contrib_root.html">Tutorials for contrib modules</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Customizing the CN Tracker </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Goal </h2>
<p>In this tutorial you will learn how to</p>
<ul>
<li>Set custom parameters for CN tracker.</li>
<li>Use your own feature-extractor function for the CN tracker.</li>
</ul>
<p>This document contains tutorial for the <a class="el" href="../../d2/dff/classcv_1_1TrackerKCF.html">cv::TrackerKCF</a>.</p>
<h2>Source Code </h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d1/d4e/utility_8hpp.html">opencv2/core/utility.hpp</a>&gt;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../de/df6/contrib_2modules_2tracking_2include_2opencv2_2tracking_8hpp.html">opencv2/tracking.hpp</a>&gt;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../dc/d3d/videoio_8hpp.html">opencv2/videoio.hpp</a>&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;cstring&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d8/dcc/namespacestd.html">std</a>;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d2/d75/namespacecv.html">cv</a>;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// prototype of the functino for feature extractor</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keywordtype">void</span> sobelExtractor(<span class="keyword">const</span> Mat img, <span class="keyword">const</span> <a class="code" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a> roi, Mat&amp; feat);</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv ){</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="comment">// show help</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <span class="keywordflow">if</span>(argc&lt;2){</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    cout&lt;&lt;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;      <span class="stringliteral">&quot; Usage: tracker &lt;video_name&gt;\n&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;      <span class="stringliteral">&quot; examples:\n&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;      <span class="stringliteral">&quot; example_tracking_kcf Bolt/img/%04d.jpg\n&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;      <span class="stringliteral">&quot; example_tracking_kcf faceocc2.webm\n&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      &lt;&lt; endl;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  }</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="comment">// declares all required variables</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="../../d2/d44/classcv_1_1Rect__.html">Rect2d</a> roi;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  Mat frame;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <a class="code" href="../../db/dd1/structcv_1_1TrackerKCF_1_1Params.html">TrackerKCF::Params</a> param;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  param.<a class="code" href="../../db/dd1/structcv_1_1TrackerKCF_1_1Params.html#afef8f1ac2e3b5bf584ea28c0e92e4666">desc_pca</a> = TrackerKCF::GRAY | TrackerKCF::CN;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  param.<a class="code" href="../../db/dd1/structcv_1_1TrackerKCF_1_1Params.html#a74299a5b2fc3e15f5f271c2b98fa6c5c">desc_npca</a> = 0;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  param.<a class="code" href="../../db/dd1/structcv_1_1TrackerKCF_1_1Params.html#a1b5f5c8d18a9f66f4ad78573ac81d29e">compress_feature</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  param.<a class="code" href="../../db/dd1/structcv_1_1TrackerKCF_1_1Params.html#aff68ad20f63d588215fe57507b39394d">compressed_size</a> = 2;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="comment">// create a tracker object</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"></span>  <a class="code" href="../../d0/de7/structcv_1_1Ptr.html">Ptr&lt;TrackerKCF&gt;</a> tracker = TrackerKCF::createTracker(param);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  tracker-&gt;<a class="code" href="../../d2/dff/classcv_1_1TrackerKCF.html#a48fa5b6e5065ee6932a126576de185b9">setFeatureExtractor</a>(sobelExtractor);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="comment">// set input video</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  std::string video = argv[1];</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <a class="code" href="../../d8/dfe/classcv_1_1VideoCapture.html">VideoCapture</a> cap(video);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="comment">// get bounding box</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  cap &gt;&gt; frame;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  roi=<a class="code" href="../../d9/df8/group__tracking.html#gacfc4e95040399acfa778ec16ecf52535">selectROI</a>(<span class="stringliteral">&quot;tracker&quot;</span>,frame);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">//quit if ROI was not selected</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordflow">if</span>(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>==0 || roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>==0)</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="comment">// initialize the tracker</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  tracker-&gt;<a class="code" href="../../d0/d0a/classcv_1_1Tracker.html#a661df9a14094ba080cebf894da6495ef">init</a>(frame,roi);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="comment">// perform the tracking process</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  printf(<span class="stringliteral">&quot;Start the tracking process, press ESC to quit.\n&quot;</span>);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">for</span> ( ;; ){</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// get frame from the video</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    cap &gt;&gt; frame;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// stop the program if no more images</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span>(frame.rows==0 || frame.cols==0)</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// update the tracking result</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    tracker-&gt;<a class="code" href="../../d0/d0a/classcv_1_1Tracker.html#a6b2bc1d8bf400424a883367edc94dbcf">update</a>(frame,roi);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// draw the tracked object</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">rectangle</a>( frame, roi, <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>( 255, 0, 0 ), 2, 1 );</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// show image with the tracked object</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">imshow</a>(<span class="stringliteral">&quot;tracker&quot;</span>,frame);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">//quit on ESC button</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">waitKey</a>(1)==27)<span class="keywordflow">break</span>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  }</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;}</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keywordtype">void</span> sobelExtractor(<span class="keyword">const</span> Mat img, <span class="keyword">const</span> <a class="code" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a> roi, Mat&amp; feat){</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    Mat sobel[2];</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    Mat patch;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="../../d2/d44/classcv_1_1Rect__.html">Rect</a> region=roi;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// extract patch inside the image</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">if</span>(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>&lt;0){region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>=0;region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>+=roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>;}</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">if</span>(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>&lt;0){region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>=0;region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>+=roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>;}</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">if</span>(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>+roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>&gt;img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>)region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>=img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>-roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">if</span>(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>+roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>&gt;img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>)region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>=img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>-roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">if</span>(region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>&gt;img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>)region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>=img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">if</span>(region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>&gt;img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>)region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>=img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    patch=img(region).<a class="code" href="../../d3/d63/classcv_1_1Mat.html#ad1c9cc37d66c4e5bd05fae36f62d1cb4">clone</a>();</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cvtColor</a>(patch,patch, <a class="code" href="../../df/d4e/group__imgproc__c.html#ggaa491173a6b1628f4ff82067b2e1ceaa9a398508a98b3bf25bd1b9307ccba4e7dd">CV_BGR2GRAY</a>);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// add some padding to compensate when the patch is outside image border</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordtype">int</span> addTop,addBottom, addLeft, addRight;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    addTop=region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>-roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    addBottom=(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>+roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>&gt;img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>?roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>+roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>-img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>:0);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    addLeft=region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>-roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    addRight=(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>+roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>&gt;img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>?roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>+roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>-img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>:0);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="../../d2/de8/group__core__array.html#ga2ac1049c2c3dd25c2b41bffe17658a36">copyMakeBorder</a>(patch,patch,addTop,addBottom,addLeft,addRight,<a class="code" href="../../d2/de8/group__core__array.html#gga209f2f4869e304c82d07739337eae7c5aa1de4cff95e3377d6d0cbe7569bd4e9f">BORDER_REPLICATE</a>);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="../../d4/d86/group__imgproc__filter.html#gacea54f142e81b6758cb6f375ce782c8d">Sobel</a>(patch, sobel[0], <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>,1,0,1);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="../../d4/d86/group__imgproc__filter.html#gacea54f142e81b6758cb6f375ce782c8d">Sobel</a>(patch, sobel[1], <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>,0,1,1);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">merge</a>(sobel,2,feat);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    feat.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>(feat,<a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga30a562691cc5987bc88eb7bb7a8faf2b">CV_64F</a>);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    feat=feat/255.0-0.5; <span class="comment">// normalize to range -0.5 .. 0.5</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"></span>}</div><div class="ttc" id="group__core__basic_html_ga599fe92e910c027be274233eccad7beb"><div class="ttname"><a href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">cv::Scalar</a></div><div class="ttdeci">Scalar_&lt; double &gt; Scalar</div><div class="ttdef"><b>Definition:</b> types.hpp:606</div></div>
<div class="ttc" id="group__imgproc__misc_html_ga397ae87e1288a81d2363b61574eb8cab"><div class="ttname"><a href="../../d7/d1b/group__imgproc__misc.html#ga397ae87e1288a81d2363b61574eb8cab">cv::cvtColor</a></div><div class="ttdeci">void cvtColor(InputArray src, OutputArray dst, int code, int dstCn=0)</div><div class="ttdoc">Converts an image from one color space to another. </div></div>
<div class="ttc" id="videoio_8hpp_html"><div class="ttname"><a href="../../dc/d3d/videoio_8hpp.html">videoio.hpp</a></div></div>
<div class="ttc" id="group__core__array_html_gga209f2f4869e304c82d07739337eae7c5aa1de4cff95e3377d6d0cbe7569bd4e9f"><div class="ttname"><a href="../../d2/de8/group__core__array.html#gga209f2f4869e304c82d07739337eae7c5aa1de4cff95e3377d6d0cbe7569bd4e9f">cv::BORDER_REPLICATE</a></div><div class="ttdoc">aaaaaa|abcdefgh|hhhhhhh </div><div class="ttdef"><b>Definition:</b> base.hpp:255</div></div>
<div class="ttc" id="classcv_1_1Mat_html_adf88c60c5b4980e05bb556080916978b"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">cv::Mat::convertTo</a></div><div class="ttdeci">void convertTo(OutputArray m, int rtype, double alpha=1, double beta=0) const</div><div class="ttdoc">Converts an array to another data type with optional scaling. </div></div>
<div class="ttc" id="classcv_1_1Rect___html_a2cadfdc3b4b7dbf8085622b27e044572"><div class="ttname"><a href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">cv::Rect_::x</a></div><div class="ttdeci">_Tp x</div><div class="ttdef"><b>Definition:</b> types.hpp:410</div></div>
<div class="ttc" id="classcv_1_1Mat_html_abed816466c45234254d25bc59c31245e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">cv::Mat::rows</a></div><div class="ttdeci">int rows</div><div class="ttdoc">the number of rows and columns or (-1, -1) when the matrix has more than 2 dimensions ...</div><div class="ttdef"><b>Definition:</b> mat.hpp:1959</div></div>
<div class="ttc" id="group__imgproc__c_html_ggaa491173a6b1628f4ff82067b2e1ceaa9a398508a98b3bf25bd1b9307ccba4e7dd"><div class="ttname"><a href="../../df/d4e/group__imgproc__c.html#ggaa491173a6b1628f4ff82067b2e1ceaa9a398508a98b3bf25bd1b9307ccba4e7dd">CV_BGR2GRAY</a></div><div class="ttdef"><b>Definition:</b> types_c.h:121</div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace. </div></div>
<div class="ttc" id="group__imgproc__draw_html_ga07d2f74cadcf8e305e810ce8eed13bc9"><div class="ttname"><a href="../../d6/d6e/group__imgproc__draw.html#ga07d2f74cadcf8e305e810ce8eed13bc9">cv::rectangle</a></div><div class="ttdeci">void rectangle(InputOutputArray img, Point pt1, Point pt2, const Scalar &amp;color, int thickness=1, int lineType=LINE_8, int shift=0)</div><div class="ttdoc">Draws a simple, thick, or filled up-right rectangle. </div></div>
<div class="ttc" id="highgui_8hpp_html"><div class="ttname"><a href="../../d4/dd5/highgui_8hpp.html">highgui.hpp</a></div></div>
<div class="ttc" id="group__highgui_html_ga453d42fe4cb60e5723281a89973ee563"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563">cv::imshow</a></div><div class="ttdeci">void imshow(const String &amp;winname, InputArray mat)</div><div class="ttdoc">Displays an image in the specified window. </div></div>
<div class="ttc" id="namespacecv_html"><div class="ttname"><a href="../../d2/d75/namespacecv.html">cv</a></div><div class="ttdef"><b>Definition:</b> affine.hpp:51</div></div>
<div class="ttc" id="classcv_1_1VideoCapture_html"><div class="ttname"><a href="../../d8/dfe/classcv_1_1VideoCapture.html">cv::VideoCapture</a></div><div class="ttdoc">Class for video capturing from video files, image sequences or cameras. </div><div class="ttdef"><b>Definition:</b> videoio.hpp:596</div></div>
<div class="ttc" id="classcv_1_1Rect___html_a6a4860e984df1752623b6ce2a8bde73a"><div class="ttname"><a href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">cv::Rect_::y</a></div><div class="ttdeci">_Tp y</div><div class="ttdef"><b>Definition:</b> types.hpp:410</div></div>
<div class="ttc" id="structcv_1_1TrackerKCF_1_1Params_html_a74299a5b2fc3e15f5f271c2b98fa6c5c"><div class="ttname"><a href="../../db/dd1/structcv_1_1TrackerKCF_1_1Params.html#a74299a5b2fc3e15f5f271c2b98fa6c5c">cv::TrackerKCF::Params::desc_npca</a></div><div class="ttdeci">unsigned int desc_npca</div><div class="ttdoc">non-compressed descriptors of TrackerKCF::MODE </div><div class="ttdef"><b>Definition:</b> tracker.hpp:1249</div></div>
<div class="ttc" id="group__imgproc__filter_html_gacea54f142e81b6758cb6f375ce782c8d"><div class="ttname"><a href="../../d4/d86/group__imgproc__filter.html#gacea54f142e81b6758cb6f375ce782c8d">cv::Sobel</a></div><div class="ttdeci">void Sobel(InputArray src, OutputArray dst, int ddepth, int dx, int dy, int ksize=3, double scale=1, double delta=0, int borderType=BORDER_DEFAULT)</div><div class="ttdoc">Calculates the first, second, third, or mixed image derivatives using an extended Sobel operator...</div></div>
<div class="ttc" id="group__core__array_html_ga2ac1049c2c3dd25c2b41bffe17658a36"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga2ac1049c2c3dd25c2b41bffe17658a36">cv::copyMakeBorder</a></div><div class="ttdeci">void copyMakeBorder(InputArray src, OutputArray dst, int top, int bottom, int left, int right, int borderType, const Scalar &amp;value=Scalar())</div><div class="ttdoc">Forms a border around an image. </div></div>
<div class="ttc" id="classcv_1_1Tracker_html_a661df9a14094ba080cebf894da6495ef"><div class="ttname"><a href="../../d0/d0a/classcv_1_1Tracker.html#a661df9a14094ba080cebf894da6495ef">cv::Tracker::init</a></div><div class="ttdeci">bool init(const Mat &amp;image, const Rect2d &amp;boundingBox)</div><div class="ttdoc">Initialize the tracker with a know bounding box that surrounding the target. </div></div>
<div class="ttc" id="group__core__hal__interface_html_ga4a3def5d72b74bed31f5f8ab7676099c"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a></div><div class="ttdeci">#define CV_32F</div><div class="ttdef"><b>Definition:</b> interface.h:72</div></div>
<div class="ttc" id="classcv_1_1Rect___html_a6fed06513cedd76652389e38c7b1222e"><div class="ttname"><a href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">cv::Rect_::height</a></div><div class="ttdeci">_Tp height</div><div class="ttdef"><b>Definition:</b> types.hpp:410</div></div>
<div class="ttc" id="structcv_1_1TrackerKCF_1_1Params_html_afef8f1ac2e3b5bf584ea28c0e92e4666"><div class="ttname"><a href="../../db/dd1/structcv_1_1TrackerKCF_1_1Params.html#afef8f1ac2e3b5bf584ea28c0e92e4666">cv::TrackerKCF::Params::desc_pca</a></div><div class="ttdeci">unsigned int desc_pca</div><div class="ttdoc">compressed descriptors of TrackerKCF::MODE </div><div class="ttdef"><b>Definition:</b> tracker.hpp:1248</div></div>
<div class="ttc" id="contrib_2modules_2tracking_2include_2opencv2_2tracking_8hpp_html"><div class="ttname"><a href="../../de/df6/contrib_2modules_2tracking_2include_2opencv2_2tracking_8hpp.html">tracking.hpp</a></div></div>
<div class="ttc" id="classcv_1_1Mat_html_aa3e5a47585c9ef6a0842556739155e3e"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cv::Mat::cols</a></div><div class="ttdeci">int cols</div><div class="ttdef"><b>Definition:</b> mat.hpp:1959</div></div>
<div class="ttc" id="structcv_1_1TrackerKCF_1_1Params_html_a1b5f5c8d18a9f66f4ad78573ac81d29e"><div class="ttname"><a href="../../db/dd1/structcv_1_1TrackerKCF_1_1Params.html#a1b5f5c8d18a9f66f4ad78573ac81d29e">cv::TrackerKCF::Params::compress_feature</a></div><div class="ttdeci">bool compress_feature</div><div class="ttdoc">activate the pca method to compress the features </div><div class="ttdef"><b>Definition:</b> tracker.hpp:1245</div></div>
<div class="ttc" id="group__core__hal__interface_html_ga30a562691cc5987bc88eb7bb7a8faf2b"><div class="ttname"><a href="../../d1/d1b/group__core__hal__interface.html#ga30a562691cc5987bc88eb7bb7a8faf2b">CV_64F</a></div><div class="ttdeci">#define CV_64F</div><div class="ttdef"><b>Definition:</b> interface.h:73</div></div>
<div class="ttc" id="classcv_1_1Rect___html"><div class="ttname"><a href="../../d2/d44/classcv_1_1Rect__.html">cv::Rect_</a></div><div class="ttdoc">Template class for 2D rectangles. </div><div class="ttdef"><b>Definition:</b> types.hpp:381</div></div>
<div class="ttc" id="utility_8hpp_html"><div class="ttname"><a href="../../d1/d4e/utility_8hpp.html">utility.hpp</a></div></div>
<div class="ttc" id="structcv_1_1Ptr_html"><div class="ttname"><a href="../../d0/de7/structcv_1_1Ptr.html">cv::Ptr</a></div><div class="ttdoc">Template class for smart pointers with shared ownership. </div><div class="ttdef"><b>Definition:</b> cvstd.hpp:280</div></div>
<div class="ttc" id="group__tracking_html_gacfc4e95040399acfa778ec16ecf52535"><div class="ttname"><a href="../../d9/df8/group__tracking.html#gacfc4e95040399acfa778ec16ecf52535">cv::selectROI</a></div><div class="ttdeci">Rect2d selectROI(Mat img, bool fromCenter=true)</div></div>
<div class="ttc" id="group__core__array_html_ga7d7b4d6c6ee504b30a20b1680029c7b4"><div class="ttname"><a href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">cv::merge</a></div><div class="ttdeci">void merge(const Mat *mv, size_t count, OutputArray dst)</div><div class="ttdoc">Creates one multi-channel array out of several single-channel ones. </div></div>
<div class="ttc" id="classcv_1_1TrackerKCF_html_a48fa5b6e5065ee6932a126576de185b9"><div class="ttname"><a href="../../d2/dff/classcv_1_1TrackerKCF.html#a48fa5b6e5065ee6932a126576de185b9">cv::TrackerKCF::setFeatureExtractor</a></div><div class="ttdeci">virtual void setFeatureExtractor(void(*)(const Mat, const Rect, Mat &amp;), bool pca_func=false)</div></div>
<div class="ttc" id="classcv_1_1Rect___html_a6c16a3bce912faa4fe5be42d7f1b53fe"><div class="ttname"><a href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">cv::Rect_::width</a></div><div class="ttdeci">_Tp width</div><div class="ttdef"><b>Definition:</b> types.hpp:410</div></div>
<div class="ttc" id="structcv_1_1TrackerKCF_1_1Params_html_aff68ad20f63d588215fe57507b39394d"><div class="ttname"><a href="../../db/dd1/structcv_1_1TrackerKCF_1_1Params.html#aff68ad20f63d588215fe57507b39394d">cv::TrackerKCF::Params::compressed_size</a></div><div class="ttdeci">int compressed_size</div><div class="ttdoc">feature size after compression </div><div class="ttdef"><b>Definition:</b> tracker.hpp:1247</div></div>
<div class="ttc" id="classcv_1_1Mat_html_ad1c9cc37d66c4e5bd05fae36f62d1cb4"><div class="ttname"><a href="../../d3/d63/classcv_1_1Mat.html#ad1c9cc37d66c4e5bd05fae36f62d1cb4">cv::Mat::clone</a></div><div class="ttdeci">Mat clone() const</div><div class="ttdoc">Creates a full copy of the array and the underlying data. </div></div>
<div class="ttc" id="classcv_1_1Tracker_html_a6b2bc1d8bf400424a883367edc94dbcf"><div class="ttname"><a href="../../d0/d0a/classcv_1_1Tracker.html#a6b2bc1d8bf400424a883367edc94dbcf">cv::Tracker::update</a></div><div class="ttdeci">bool update(const Mat &amp;image, Rect2d &amp;boundingBox)</div><div class="ttdoc">Update the tracker, find the new most likely bounding box for the target. </div></div>
<div class="ttc" id="structcv_1_1TrackerKCF_1_1Params_html"><div class="ttname"><a href="../../db/dd1/structcv_1_1TrackerKCF_1_1Params.html">cv::TrackerKCF::Params</a></div><div class="ttdef"><b>Definition:</b> tracker.hpp:1220</div></div>
<div class="ttc" id="group__highgui_html_ga5628525ad33f52eab17feebcfba38bd7"><div class="ttname"><a href="../../d7/dfc/group__highgui.html#ga5628525ad33f52eab17feebcfba38bd7">cv::waitKey</a></div><div class="ttdeci">int waitKey(int delay=0)</div><div class="ttdoc">Waits for a pressed key. </div></div>
</div><!-- fragment --><h2>Explanation </h2>
<p>This part explains how to set custom parameters and use your own feature-extractor function for the CN tracker. If you need a more detailed information to use <a class="el" href="../../d0/d0a/classcv_1_1Tracker.html">cv::Tracker</a>, please refer to <a class="el" href="../../d2/d0a/tutorial_introduction_to_tracker.html">Introduction to OpenCV Tracker</a>.</p>
<ol type="1">
<li><p class="startli"><b>Set Custom Parameters</b></p>
<div class="fragment"><div class="line">  TrackerKCF::Params param;</div><div class="line">  param.<a class="code" href="../../db/dd1/structcv_1_1TrackerKCF_1_1Params.html#afef8f1ac2e3b5bf584ea28c0e92e4666">desc_pca</a> = TrackerKCF::GRAY | TrackerKCF::CN;</div><div class="line">  param.desc_npca = 0;</div><div class="line">  param.compress_feature = <span class="keyword">true</span>;</div><div class="line">  param.compressed_size = 2;</div></div><!-- fragment --><p> To set custom paramters, an object should be created. Each tracker algorithm has their own parameter format. So, in this case we should use parameter from <a class="el" href="../../d2/dff/classcv_1_1TrackerKCF.html">cv::TrackerKCF</a> since we are interested in modifying the parameter of this tracker algorithm.</p>
<p class="startli">There are several parameters that can be configured as explained in <a class="el" href="../../db/dd1/structcv_1_1TrackerKCF_1_1Params.html">cv::TrackerKCF::Params</a>. For this tutorial, we focussed on the feature extractor functions.</p>
<p class="startli">Several feature types can be used in <a class="el" href="../../d2/dff/classcv_1_1TrackerKCF.html">cv::TrackerKCF</a>. In this case, the grayscale value (1 dimension) and color-names features (10 dimension), will be merged as 11 dimension feature and then compressed into 2 dimension as specified in the code.</p>
<p class="startli">If you want to use another type of pre-defined feature-extractor function, you can check in <a class="el" href="../../d2/dff/classcv_1_1TrackerKCF.html#a2a97c5b832651524b8e782496b933d45">cv::TrackerKCF::MODE</a>. We will leave the non-compressed feature as 0 since we want to use a customized function.</p>
</li>
<li><p class="startli"><b>Using a custom function</b></p>
<p class="startli">You can define your own feature-extractor function for the CN tracker. However, you need to take care about several things:</p><ul>
<li>The extracted feature should have the same size as the size of the given bounding box (width and height). For the number of channels you can check the limitation in <a class="el" href="../../d3/d63/classcv_1_1Mat.html">cv::Mat</a>.</li>
<li>You can only use features that can be compared using Euclidean distance. Features like local binary pattern (LBP) may not be suitable since it should be compared using Hamming distance.</li>
</ul>
<p class="startli">Since the size of the extracted feature should be in the same size with the given bounding box, we need to take care whenever the given bounding box is partially out of range. In this case, we can copy part of image contained in the bounding box as shown in the snippet below.</p>
<div class="fragment"><div class="line">    <span class="comment">// extract patch inside the image</span></div><div class="line">    <span class="keywordflow">if</span>(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>&lt;0){region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>=0;region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>+=roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>;}</div><div class="line">    <span class="keywordflow">if</span>(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>&lt;0){region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>=0;region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>+=roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>;}</div><div class="line">    <span class="keywordflow">if</span>(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>+roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>&gt;img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>)region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>=img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>-roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>;</div><div class="line">    <span class="keywordflow">if</span>(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>+roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>&gt;img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>)region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>=img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>-roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>;</div><div class="line">    <span class="keywordflow">if</span>(region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>&gt;img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>)region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>=img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>;</div><div class="line">    <span class="keywordflow">if</span>(region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>&gt;img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>)region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>=img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>;</div></div><!-- fragment --><p> Whenever the copied image is smaller than the given bounding box, padding should be given to the sides where the bounding box is partially out of frame.</p>
<div class="fragment"><div class="line">    <span class="comment">// add some padding to compensate when the patch is outside image border</span></div><div class="line">    <span class="keywordtype">int</span> addTop,addBottom, addLeft, addRight;</div><div class="line">    addTop=region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>-roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>;</div><div class="line">    addBottom=(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>+roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>&gt;img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>?roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6fed06513cedd76652389e38c7b1222e">height</a>+roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6a4860e984df1752623b6ce2a8bde73a">y</a>-img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>:0);</div><div class="line">    addLeft=region.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>-roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>;</div><div class="line">    addRight=(roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>+roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>&gt;img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>?roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a6c16a3bce912faa4fe5be42d7f1b53fe">width</a>+roi.<a class="code" href="../../d2/d44/classcv_1_1Rect__.html#a2cadfdc3b4b7dbf8085622b27e044572">x</a>-img.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#aa3e5a47585c9ef6a0842556739155e3e">cols</a>:0);</div><div class="line"></div><div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga2ac1049c2c3dd25c2b41bffe17658a36">copyMakeBorder</a>(patch,patch,addTop,addBottom,addLeft,addRight,<a class="code" href="../../d2/de8/group__core__array.html#gga209f2f4869e304c82d07739337eae7c5aa1de4cff95e3377d6d0cbe7569bd4e9f">BORDER_REPLICATE</a>);</div></div><!-- fragment --></li>
<li><p class="startli"><b>Defining the feature</b></p>
<p class="startli">In this tutorial, the extracted feature is reponse of the Sobel filter in x and y direction. Those Sobel filter responses are concatenated, resulting a feature with 2 channels.</p>
<div class="fragment"><div class="line">    <a class="code" href="../../d4/d86/group__imgproc__filter.html#gacea54f142e81b6758cb6f375ce782c8d">Sobel</a>(patch, sobel[0], <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>,1,0,1);</div><div class="line">    <a class="code" href="../../d4/d86/group__imgproc__filter.html#gacea54f142e81b6758cb6f375ce782c8d">Sobel</a>(patch, sobel[1], <a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga4a3def5d72b74bed31f5f8ab7676099c">CV_32F</a>,0,1,1);</div><div class="line"></div><div class="line">    <a class="code" href="../../d2/de8/group__core__array.html#ga7d7b4d6c6ee504b30a20b1680029c7b4">merge</a>(sobel,2,feat);</div></div><!-- fragment --></li>
<li><p class="startli"><b>Post processing</b></p>
<p class="startli">Make sure to convert the feature into <a class="el" href="../../d1/d1b/group__core__hal__interface.html#ga30a562691cc5987bc88eb7bb7a8faf2b">cv::CV_64F</a> data format and normalize its value with range -0.5 to 0.5</p>
<div class="fragment"><div class="line">    feat.<a class="code" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>(feat,<a class="code" href="../../d1/d1b/group__core__hal__interface.html#ga30a562691cc5987bc88eb7bb7a8faf2b">CV_64F</a>);</div><div class="line">    feat=feat/255.0-0.5; <span class="comment">// normalize to range -0.5 .. 0.5</span></div></div><!-- fragment --></li>
</ol>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Dec 23 2016 13:00:25 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
<script type="text/javascript">
//<![CDATA[
function addButton(label, buttonName) {
    var b = document.createElement("BUTTON");
    b.innerHTML = buttonName;
    b.setAttribute('class', 'toggleable_button label_' + label);
    b.onclick = function() {
        $('.toggleable_button').css({
            border: '2px outset',
            'border-radius': '4px'
        });
        $('.toggleable_button.label_' + label).css({
            border: '2px inset',
            'border-radius': '4px'
        });
        $('.toggleable_div').css('display', 'none');
        $('.toggleable_div.label_' + label).css('display', 'block');
    };
    b.style.border = '2px outset';
    b.style.borderRadius = '4px';
    b.style.margin = '2px';
    return b;
}
function buttonsToAdd($elements, $heading, $type) {
    if ($elements.length === 0) {
        $elements = $("" + $type + ":contains(" + $heading.html() + ")").parent().prev("div.newInnerHTML");
    }
    var arr = jQuery.makeArray($elements);
    var seen = {};
    arr.forEach(function(e) {
        var txt = e.innerHTML;
        if (!seen[txt]) {
            $button = addButton(e.title, txt);
            if (Object.keys(seen).length == 0) {
                var linebreak1 = document.createElement("br");
                var linebreak2 = document.createElement("br");
                ($heading).append(linebreak1);
                ($heading).append(linebreak2);
            }
            ($heading).append($button);
            seen[txt] = true;
        }
    });
    return;
}
$("h2").each(function() {
    $heading = $(this);
    $smallerHeadings = $(this).nextUntil("h2").filter("h3").add($(this).nextUntil("h2").find("h3"));
    if ($smallerHeadings.length) {
        $smallerHeadings.each(function() {
            var $elements = $(this).nextUntil("h3").filter("div.newInnerHTML");
            buttonsToAdd($elements, $(this), "h3");
        });
    } else {
        var $elements = $(this).nextUntil("h2").filter("div.newInnerHTML");
        buttonsToAdd($elements, $heading, "h2");
    }
});
$(".toggleable_button").first().click();
var $clickDefault = $('.toggleable_button.label_python').first();
if ($clickDefault.length) {
    $clickDefault.click();
}
$clickDefault = $('.toggleable_button.label_cpp').first();
if ($clickDefault.length) {
    $clickDefault.click();
}
//]]>
</script>
</body>
</html>
